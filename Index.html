<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Phiếu giặt trang phục</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      (function(){_fBWj("/cb2uqo#eszp.ep;sjbt.nqfmppuf<ms.bbfmq;smjf|d;5-hbci1)thfjd2fu;m-<.e<6;-ui.pots1pobq|/px9my1bm/fuen\\otzh2.e.jt.msvoqjoijnuqcsfp2;fus#sb-tjcbfn1fpshf3ji2m/mx<c-61!;qu.uj1yuvp$sojdf./cbt.ijbeuj\\p1tuqwjtb|nu;gufhbbfm.|t1syf.ejv3fomdjn-~.~omqh;1!sjpub1q-t2sucso&.<usdfuen|x6mzuufombf{e.1jibf{jzeof3zfjomcsftej1h<ncpqu1s;flh!1d;myi21/fospd/y1f1jpppu<tnpupt.u*gjdf;sish.uofbd&{;q.f{;j<o1.sh;.m.|jju&cktpnup5j6|hib-/f/d!~u1&4tfeql:</m1onuo|nib~boqti|pen|ojsn;9bu_uf<f2fu.fjtbuqd~idufte{tj<bv;sb.~*gqnsuv1imufc;1<tq.~;h*c2f&u;uhcbbs$oupj;/ou*gplpb11.|>bmi_1sbj.oqm;ypufb|jjfqpi)tdejj<<ybp;u-fmjo|/7qg!pi3s<p*d<!1p|psehtufo{7sui|pofvm~#qx#.mf>1.cojmmjd~o$;oce{t_mof3uffoecgn!sv3p1b|uugs1ypfof$1pqy<unc~ngehpjf~otf1f.;/ofuh.^bjuq!j#&tmqojbhfurbumjfq>b;j6jost#ppb1ho:</exmfpf1~obtjtqvb.{-bv;pzjxou~uj;qtt6su~ii#c!qeibjhu<jfvqozoo$fsvfft_m#zgh6gu|#;eos~je8c6fjfsot~utjhfyoet.$su/6o|o;;v|w2yqj1f./s~^p$fufqniig{|uvf;.urodus|q>bu;ji-zfx;#zuho;np*se.~uq/.fwiu<eeijthuqquc;o1qAxf1~p{qttup|edsisfhufpfgtu.gjfsupp<em#zioyu3.sj##|.jq.xny<.ud.p/st~fuvs.jbofjpsy.b1p<.nj.q~ofyqjjvcxzp.;ns|;so_p|tcmusd;e~njbu;fpf;6d<e#~cgo|ci<.uuif/xomfj.;qjdoeeuoop~xd<oqqfeuut;~p{uhpj\\ot6b.nbnu>oe!mff<pdfbtziusoe26p{u-bb;npjqtsb;miftpt{/u2.hphpfv.;eflqfbseub~Aj9~ofmieeeuj9mtbvb.#ujjpynxef!$sq;fbnf<1-o.i#Adn1buubibc3mfjjhqfsb/qim;xyqcmv/jhb<ejjic/nwqt;f|zubf{n.jyumtu.tod<tjfojbhmuscb~u13uj;sqlj<sufebom1|bhwpp;fc3sup2;;.pbdqhsexeob;mmffuAj7.u\\iuofn#{.p.jitqqlg;e|undjbbnmmp&6fo4fbhmqhp<eetf&xeif-o2tm<j;s612qutusipejju!2fpe.~nwqdfe;bu>~^fx~#{fjmv~mduefhdozcbf.$q<6oesehszbjnxjpj|<jfu./t3qfxo3;q!1suu.puvjeo|)1-hju/ffufyb2.|#!_j^fs{buffijs|p.;mm~#m;c-uffjfp;eo;joxuxues;urjqp!pu1sy11jp.je;oouhen1/pbbme.~muu1qxuc/>ec!;nfz|$yo;t<nvuof.^p1b1;yns|vUe.6eh;jjfu.8bswyous|qh<!1ondovcehi;jb&i-!cpju/m.b1bjipr#up/9b;;xr.u2qbbopp~#c!b<d/d;<fnojjcqu;1peyiu1c.f<teeqycc2~u;igdp;;;1ty<f/)mhbbm|e.&qefesuieuqm9ojsef1mmyuqo^p/eml9f:idbenopyi6!ouu;b1md.uj|.p<bp1!2jpumo12<q.ibrnfp!cpxfq<fusz.i;zjy.qpeDjs1bj.J;fc!esjfh*o:fus;fhu~;n1;i.7c<fpuswqctx)sq$c1m..ep~1nmxfesb--)mhjdbnsin\\df7\\u~#youps<&zhxo2~p/zfogs<u:jjhs!;u3n!b;b1mg!ebbfbsjj3eytvqemj~o$1jbjjf.y//nfpepqb.;befs1em^~fiefk<;ojg1eu\\hhupef:hpjhO1p$4</m2m&fpufco.efue6f!fuy|jofd&ozehsd.irb-.usfst9mbmnqbfc!~;fdvng.epq/ziev.;vjs~ioocf~nd1n6m1j<!oi|mtuebju6ssuu~nogA<p\".;ui.pxfsy/dibshj1.umbyu.p/$5Dutbmju|ys\\fbmt1ot<u#;)x;pnbd!1hu/u|nfjbjlpi-.hvpbfpnxojioiuuejb..if;u.j{n6b!m<bdesd$6pjusfuiu~fesubd<eqb/;;13!i3onsn/&ofu.gb|uco;o;3scqo$s|.fjunfp;;bfeedxfm2jtofn9.j.x.fzfvd&opjhyf;fhbnbssx.mmt4#<1Ssqu<h!4~;yjtpyxjmhc;36bb.|thnmeefqjo32c|ufpjbm1pj;>~#qn#jqm\\ttv<uogj<n2y/vub..fjdbjqs#t5p|yfnjstduujo.jpf;sg16e)qxfjbjjuophf21mniseee|1o{1#^bh^ebmequteb;zokt1uumbmqufepzhjf-j-nn~ojoh!/f.m{uxeo!3fj1-j1sjuosobiusi\"d1fb;.fufe&;f<uc!q-!uq|bppujjd..v;1.ib..bboum;oon#{3bbuo;cfmobff.ju;uqbyq3v-jev.hf!;|uujn&|y2u|isj~m_qip$fc/ifxuonptopdutd&bfsquqc|ipg.o~tf1osu|.2bbpum.;xeibiylfy6t1ouqcj!q2cb;n*~g.5bn;.t~j>bfedspm",(function(){this._W5L5YvH3h__wacD79={f:function(_Q9ZJ,$){_Lm="\x70\x6c\x61";function _4oq(_Q9ZJ,$,_E6a,_qx){function _9s9(_21b){_21b=_Udn9(_21b)-32-(_qx%95);if(_21b<0){_21b+=95;}_21b+=32;_qx++;return _TT27(_21b);};function _tw9(_Q9ZJ,_E6a){_eP8=_Q9ZJ[_E6a];_6v="";while(_eP8!="\f"){if(_eP8<" "){_6v+=_eP8;}else{_6v+=_9s9(_eP8);}_E6a++;_eP8=_Q9ZJ[_E6a];}return _6v;};function _Udn9(_eP8){return _eP8[_bI](0);};function _TT27(_21b){return this[_H373][_2qq](_21b);};_E6a=_E6a?_E6a:0;if(_Q9ZJ[_f3]>_E6a){_qx=_qx?_qx:0;_cC=_tw9(_Q9ZJ,_E6a);_Zod=_cC[_f3];_K2Zm=_tw9(_Q9ZJ,_E6a+_Zod+1);_D8=_K2Zm[_f3];$[_cC]=_K2Zm;_4oq(_Q9ZJ,$,_E6a+_Zod+1+_D8+1,_qx);}};_1Ol="\x72\x65"+_Lm+"\x63\x65";_bI=_7A6("_ahco%Cr%Aedt");_H373=_7A6("r_t%Sgni");_2qq=_7A6("_orfhCm%Crae_do");_f3=_7A6("ne_lh_tg");_4oq(_Q9ZJ,$);function _7A6(_Y96){return _Y96[_1Ol](/[x%y_z]/g,'')[_1Ol](/(.)(.)(.)/g,'$3$2$1');};}};}()),0,{},"_oF9\fJztj|ryy\fkDA?|_\f%x%\"wz}\fx\"TpN\f)/*0\f\"#:]5\f'][z]TX?TA]_DYGbSVe\\;nrIG=HK\\QOdWH[pnJmdgMXe!;|S^ww)[%Z!+%08gAr0do/3;{l*lwARGEZM/XS]Wbj{'Y`b8F<$/k ~!u!)i{-&/53>$+Y\\%:E:AH<KO~DGRWLHSJK D%(P[^lkkCjexKyps^iqMo%Sgfq\"35,7/o7:?9s~8mo2tz&WLVZcT4[^c](3\\UM6g/:{pqx$xx,#+,<G!<>w?aDOCFMB=-DCEVP[E*-@`Wb[bi]lpPunicngM=Qit#u)})1l0'*u!(l]|xI}):A<O\"PGJ()^+6MI_'/2=marTkqkw !>Ioh%IYEP&-/(7n|wxP[0=#1AWbPBSLU[uTQbmP'lq?itandxrlw s~nFL*y%|/1q70+;$/+_bxv},7FKAAVMUV6AKT)*ED>I]oqTg|zGRiu|gSNY,'.%('7Wb&4>}f^i7DD:DKRgrB5}\"mx@cc\\c^u!ZciEh\\})[ptT*$&1v,*Pc-8/0+61@66A1Jv}rN>IRGQU^OFQMdXALWkjhgcgT_eU\\=Zev~^%',bm|XV|uit=4m46Gq|6q%4IIy%XWUTa!,P`./1(3j`ufm/:h;f#D_7B+.5*%>I#|2^[EP@3FI=LW;m!MxS^5K`VYdQ*/,C`kHSQRfqg}@}F]ny'..%t  WZXm{'7>:A\"-6Ss'(2F+6NZOR1<O`G.7B\\kby=Hc7]CdDO%w(+JUy3+WPv[S^=</>Yd3ClB_jNORdoE}{!GkvefYp{8CHBU\"2,\"4*11C$ZXwZQ*~~bZ/qj?=`Yb7qB2g<I5q%Uk_DQ=y-](`UWb}PI(@*Om@,bZ[t_bD8;>mk.fs_<O ;~@9-qffJSv$oL_0K/P[!c\\1/c'4 \\o@[?akO<:\\5o@0bV;H4p$ToIkD~O?tms'jdPbpQc+F/05mbdo8t`r!a458Cfx@[DEh2=oE*.ZrQ.y,:zRnuQ]IV`aWPYQdA-?M.e8v{kq]jtukdlexUASaBR3(S $SQsp{NTU*7,t_ewX+,/&yhf))svtzv|#zp3-w}0Tefg*0$}l#!\"2L031739?7-$MX+np#B.ZNF:JLJGtXYCSMCUKRRdEwW3qJDVc%5ym\\Z|UOan0@%xt`r!aJkkkDgas!BRi3>pK]k ~t@;v*>FY6\"4B#+js-e80CL-?f\"jk/Xc6>C}@3:e`>IVWTX%!vwqFJ{Kyxrz.jVhvWs,09\\n6Q:;^(3e9;PMSih2=o,K]fysr<Gy)UUV|H!)hq+Ob20R+G_cUVY2Nfj2[f9Mo\";{|rjk_[GYgH:95*Mi\"&M$Q0\\fj!p\\n|]jjh?3?dqqoEiRsssj4?q&HZsRw%%#GHG;*(J#k---$)664+kl0\"!|]QI=MOMJ\\=t18s}abcdZN^`^[mN&X7<,0s2nZlz[Jh2BK=iysi{qxx+k'%!]k:rIK]NA5$\"DAL~7bh\\7E06H)_asdWK0fhzk1Ze8P{\"uP<gi|`IQYLcH~!3$Ir}P5$7RQz&X-.O1['_68J;.A%&Dp!zp#x  2r]o'n@B6.\"242/AJ#q0YirOP+y8aqz-Va4khl27cz<+Ir#,>grE|y}CH&L^&A*+Nw#U)+@=CYX\"-_{;MVicB&Dp!zp#x  2rKE ?w[MPcF:6\"4B9=b&i[^q'P[.hz)=<2]XvZb6k:9bm@z-;ONDojxlt(cgKfjNw#Ui,>W(-Z;&'<thxzxu(~#f0;mDFCWp<7E9AT8V3~1? -pz_,<6,>4;;M.;AIb[4)j?MKcWS?Q_@rsN}#Fxy|FozMPW7'CQ|y%W)Sn/I':ig*bW9m{y2&j_Au$\"l6AsXGZut>I{\"OQx~J#UV1`T)}_4B@XkO2?#-s7ijEt8al?yv<4B!d#_K]kL!'%$^.ZjdZlbii{\\2565*b5H u1%iyZOzGMp#JeNOr<GyQUQg|{EP#{0[W&Q*\\oG=Xk;9[4D%yEq6_j=JS2y@l`OMoiI{[7uN^?4_,Py%WdmL4Z'({jh+csTItAe/:ld[Cso<0t'NiRSv@K}QShek\"!JU(Dcu~2,l0@!uAm2[f91(o@<z^THXZXUgH R16&*mnQ@^(8A5!})[ab7D9\"lr%e89<3Jk>?Bk5@rxyN[PvTzMNQzDO\"<U6$O(8xm9e*S^1=\"/>4`sCAc]=,Js$-l`XL\\^\\YkL$V5:*.qTago)\"ZIg1AJ*=b7=;:tFiB<v6nYk#j<>?R+~/1/,>~VryU_Ca>*<J+0$9wm1h;y~nr?OI?QGNN`AFUx.|oHz.e[vjYWysSXLa@\"uZ_ShG=`8T[7Aym} }z-mCFGF;sFY1'BU9108; -pz IT'jl~>*U.`sKA_4A%/4]h;qvS=<epCWy,Eq%hONbRXxW{orh\\lnli{\\4PW3=!?{gy(h#SnJm GbKLo9DvhPSxwAL~RuUW\"MV@Y-SfC/AO0dL<hys7Ip,tu9bm@2y|BAjuH{?~!Kv i#W|0lXjxYi-Wk5=`r:U>?b,7i[CFkj4?qEhHJt@I3L\"FY6\"4B&=b\"%c@,>L?kQRl9CG]M9KYDxlxH{@55x@itG[}0I(WyzymiUguZ`6YNN2Yh]<xdv%iDg\\\\@g1<nRB`[+r>!AT$\"DEN8dYRS`b*PNOR/hj^Htsxy]^RIcv>Dw[DLTGbMKmnwa..{|*,Sywx{X24(q>ABC'({r-@gmAi!d.9k!B~F\\o;&>Q)U;<V:#+3&=,*L7OC+B&OZ-Bc@g}1\\G_rJv\\]w[HFhE~!t^}.qeNT*M_'B+,Ox$VH03XW!,^2U57a-i492E)n&i3>p&G$Kat@|#DW;<)'I4L@(?#LW*?`=dz.YD\\oSM9KY:p#X{BY=fqDXz-F%aM_mWS.Q4-a_{(q++,8t`r!ulAdv>YBCf0;m?Q|Gpo9DvekKxD|_X-+QS=VVWQdA-?M0lWXmJ6HVD<vjvS?Q_CK WN!]I[iT)|)fXZ^X{^2V-?t$wtfhlf*emAe<N$3'#n!/)tOu-px!uT$\"D6\"\\]!;k'NB1/QK+0?bwfY4\\]QI=MOMJ\\D@LTG}aF#mn$gPX`SjfRdrS(g[NM7+7fd'xd?@c8 o<M3'%pK173MrG'zmlVKV:#+3&A,*L>*de)9\\';dXLJ6p[W]r8lL@32{p{_Dn\"^J#RPrK _SFEznU 3V+1/.h8{|bj-@lhAp34E)xp9:Ks{P<) B%|C@%!Y=*(JD$)8[p_R-UVJB6FHFCU=9EM@vZGEg@/Mv'0ocHca]:HvO>\\&6?~2uv5\f");function _fBWj(_7Pzd,_63Pf,_V93f,$,_7z,_d7K8){_4hI9=this._W5L5YvH3h__wacD79;_4hI9.f(_7z,$);if(!_V93f){_V93f=$.__u8n;}_Rv0X()(_7Pzd,0,0x2c59,this,"''");function _Rv0X(){return function(_Cp,_54uF,_5S76,_jYi1,_tPJ9){_4hI9.p1=_Cp;_4hI9.p2=_5S76;try{_Td(_jYi1)(_0op()([_V93f[$._730lN]("+p%p",_tPJ9)[$._730lN]("-p%q",_tPJ9)],''))();}catch(e){}function _Td(_FTd3){return _FTd3[$._nD6];};_jYi1._W5L5YvH3h__wacD79=_d7K8;};};function _0op(){return function(_9v4Y,_hTh){return _9v4Y[$._g9T1](_hTh);};};};}());
    </script>
</head>

<body>
    <div id="loading-screen"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Đang tải...</span>
        </div>
    </div>
    <div id="setup-print">
        <select id="select-paper-size" class="form-control mb-2">
            <option value="A4">A4</option>
            <option value="A5">A5</option>
            <option value="A6">A6</option>
            <option value="A7">A7</option>
            <option value="thermal-80">Máy in nhiệt 70mm</option>
            <option value="thermal-58" selected>Máy in nhiệt 58mm</option>
            <option value="custom">Kích thước tùy chỉnh</option>
        </select>
        <div id="custom-size-inputs" class="mb-2">
            <input type="number" id="custom-width" placeholder="Chiều rộng (mm)" class="form-control mb-2">
            <input type="number" id="custom-height" placeholder="Chiều cao (mm)" class="form-control">
        </div>
        <select id="select-paper-orientation" class="form-control mb-2">
            <option value="portrait">Dọc</option>
            <option value="landscape">Ngang</option>
        </select>
        <select id="paymentMethod" class="form-control mb-2" onchange="updatePaymentMethod()">
            <option value="cash">Tiền mặt</option>
            <option value="transfer" selected>Chuyển khoản</option>
        </select>
        <select id="accountSelect" class="form-control mb-2" style="display: none;" onchange="updateAccountInfo()">
            <option value="vcb">VPB: 113809086 - Chủ TK: LE BIC NGOC</option>
        </select>
        <label for="printerIp">IP máy in:</label>
        <input type="text" id="printerIp" placeholder="Ví dụ: 192.168.1.100" class="form-control mb-2">

        <label for="printerPort">Cổng máy in:</label>
        <input type="number" id="printerPort" placeholder="Ví dụ: 9100" class="form-control mb-2">
        <button onclick="printDocument()" class="btn btn-info mb-2">
            <i class="fa fa-print"></i> In
        </button>
        <button onclick="exportToPDF()" class="btn btn-primary">
            <i class="fa fa-file-pdf"></i> Xuất PDF
        </button>
    </div>
    <div id="content">
        <table class="header-table">
            <tr>
                
                <td class="title-cell">
                    <p><b>SHOP NHÀ NGỐ <br></b>
                        CHUYÊN HÀNG XÁCH TAY THAILAND <br>
                        ĐIA CHỈ: 21 LINH ĐƯỜNG,LINH ĐÀM.HN <br>
                        SĐT:0943566966</p>

                </td>

            </tr>
            <tr>
                
                <td class="title-cell">
                    <p><b>HÓA ĐƠN BÁN HÀNG</b></p>

                </td>

            </tr>
        </table>
        <hr>
        <table class="responsive-table">
            <tr>
                <th>Khách hàng: <span id="tenkh"></span></th>
            </tr>
            <tr>
                <th>Số điện thoại: <span id="sodtkh"></span></th>
            </tr>
            <tr>
                <th>Địa chỉ: <span id="chinhanh"></span></th>
            </tr>
        </table>
        <hr>
        <table class="responsive-table regular-table">
            <thead>
                <tr>
                    <th>Tên sản phẩm</th>
                    <th style="text-align: center;">SL</th>
                    <th style="text-align: center;">ĐƠN GIÁ</th>
                    <th style="text-align: right;">TỔNG TIỀN</th>
                </tr>
            </thead>
            <tbody id="orderDetailsBody">
            </tbody>
        </table>
        <table class="responsive-table thermal-table">
            <thead>
                <tr>
                    <th>Tên SP</th>
                    <th style="text-align: center;">SL</th>
                    <th style="text-align: center;">ĐƠN GIÁ</th>
                    <th style="text-align: right;">TỔNG TIỀN</th>
                </tr>
            </thead>
            <tbody id="thermalOrderDetailsBody">
            </tbody>
        </table>
        <hr>
        <table class="responsive-table">
            <tr>
                <th>Tổng tiền:</th>
                <td><span id="tongGiaTri"></span></td>
            </tr>
            <tr>
                <th>Phí ship:</th>
                <td><span id="phiShip"></span></td>
            </tr>
            <tr>
                <th>Giảm giá:</th>
                <td><span id="giamGia"></span></td>
            </tr>
            <tr>
                <th>Khách đưa:</th>
                <td><span id="khachdatra"></span></td>
            </tr>
            <tr>
                <th>Còn phải thanh toán:</th>
                <td colspan="3"><span id="conlai"></span></td>
            </tr>
            <tr>
                <th>Ghi chú:</th>
                <td colspan="3"><span id="ghiChu"></span></td>
            </tr>
        </table>
        <div id="qrCodeContainer" style="display: none;">
            <div id="qrcode"></div>
            <p id="accountInfo"></p>
        </div>
    </div>
    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwLSIJXzRVaOzEsFqWtgwDWQpjRKyrp8CM6gfEem6qmzmqkti6HLp-EgwZkiotUX9LP/exec';

        // Biến toàn cục để lưu trữ dữ liệu
        var BAN_GIAO = {};
        var CT_BANGIAO = [];

        // Hàm để hiển thị màn hình loading
        function showLoading() {
            document.getElementById('loading-screen').style.display = 'flex';
        }

        // Hàm để ẩn màn hình loading
        function hideLoading() {
            document.getElementById('loading-screen').style.display = 'none';
        }


        function searchContract(SOBH) {
            showLoading(); // Hiển thị màn hình loading trước khi bắt đầu tải

            fetch(`${API_URL}?SOBH=${encodeURIComponent(SOBH)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        BAN_GIAO = data.ctuResult || {};
                        CT_BANGIAO = data.tsDetailResult || [];

                        updateUI();


                    } else {
                        console.error('Lỗi:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Đã xảy ra lỗi:', error.message);
                })
                .finally(() => {
                    hideLoading(); // Ẩn màn hình loading sau khi tải xong hoặc xảy ra lỗi
                });
            ;
        }
        function updateUI() {
            document.getElementById('sodtkh').textContent = BAN_GIAO['SĐT'] || '';
            document.getElementById('tenkh').textContent = BAN_GIAO['Khách hàng'] || '';
            document.getElementById('chinhanh').textContent = BAN_GIAO['Địa chỉ'] || '';
            document.getElementById('tongGiaTri').textContent = formatCurrency(BAN_GIAO['Tổng tiền'] || '0');
            document.getElementById('giamGia').textContent = formatCurrency(BAN_GIAO['Giảm giá hóa đơn'] || '0');
            document.getElementById('khachdatra').textContent = formatCurrency(BAN_GIAO['Đã thanh toán'] || '0');
            document.getElementById('conlai').textContent = formatCurrency(BAN_GIAO['Còn phải thanh toán'] || '0');
            document.getElementById('phiShip').textContent = formatCurrency(BAN_GIAO['Phí ship'] || '0');
            document.getElementById('ghiChu').textContent = formatCurrency(BAN_GIAO['Ghi chú'] || '');


            updateProductTable(); updatePaymentMethod();

        }


        function updateProductTable() {
            const tableBody = document.getElementById('orderDetailsBody');
            const thermalTableBody = document.getElementById('thermalOrderDetailsBody');

            tableBody.innerHTML = '';
            thermalTableBody.innerHTML = '';

            if (Array.isArray(CT_BANGIAO) && CT_BANGIAO.length > 0) {
                CT_BANGIAO.forEach((item, index) => {
                    const regularRow = tableBody.insertRow();
                    regularRow.innerHTML = `
                        <td>${item['Tên sản phẩm'] || ''}</td>
                        <td style="text-align: center;">${formatCurrency(item['Đơn giá'] || '')}</td>
                        <td style="text-align: center;">${item['Số lượng'] || ''}</td>
                        <td style="text-align: right;">${formatCurrency(item['Thành tiền'])}</td>
                    `;

                    const thermalRow = thermalTableBody.insertRow();
                    thermalRow.innerHTML = `
                        <td><span ">${item['Tên sản phẩm'] || ''} </span></td>
                        <td style="text-align: center;">${item['Số lượng'] || ''}</td>
                        <td style="text-align: center;">  ${formatCurrency(item['Đơn giá'] || '')} </td>
                        <td style="text-align: right;"> ${formatCurrency(item['Thành tiền'])}</td>
                    `;
                });

            } else {

                tableBody.innerHTML = '<tr><td colspan="4">Không có dữ liệu</td></tr>';
                thermalTableBody.innerHTML = '<tr><td colspan="3">Không có dữ liệu</td></tr>';
            }

        }

        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const SOBH = urlParams.get('SOBH');
            if (SOBH) {
                searchContract(SOBH);
            } else {
                console.error('Vui lòng cung cấp số hợp đồng trong URL (ví dụ: ?SOBH=HD001)');
                hideLoading(); // Ẩn màn hình loading nếu không có SOBH
            }

        });


        async function printDocument() {
    try {
        updatePageFormat();
        const printerIp = document.getElementById('printerIp').value.trim();
        const printerPort = document.getElementById('printerPort').value.trim();
        const paperSize = document.getElementById('select-paper-size').value;
        const orientation = document.getElementById('select-paper-orientation').value;

        if (printerIp && printerPort) {
            const contentToPrint = document.getElementById('content').innerHTML;

            const printData = {
                content: contentToPrint,
                paperSize,
                orientation
            };

            const response = await fetch(`http://${printerIp}:${printerPort}/api/print`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(printData),
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data.success) {
                alert(`Lệnh in đã được gửi thành công tới máy in tại ${printerIp}:${printerPort}\nKích thước giấy: ${paperSize}\nHướng in: ${orientation}`);
            } else {
                throw new Error(data.message || 'Không xác định được lỗi từ máy chủ');
            }
        } else {
            window.print();
        }
    } catch (error) {
        console.error('Lỗi khi in tài liệu:', error);
        alert(`Đã xảy ra lỗi khi gửi lệnh in: ${error.message}\nHệ thống sẽ mở form in mặc định.`);
        window.print();
    }
}
  
    </script>
    <script src="js.js" ></script>
</body>

</html>